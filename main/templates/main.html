{% extends 'base.html' %}
{% block content %}

<div class="w-full mt-10 px-6" style="background-color: #FBF9E4; min-height: 100vh;">
   
    <div class="mb-8">
        <h1 class="text-5xl font-extrabold text-gray-900 mb-2" style="color:#122C4F;">
            Hello {{ current_user }}
        </h1>
        <p class="text-lg text-gray-600">
            What are u lookin for today?
        </p>
    </div>

    <!-- ðŸ”¥ Section Produk -->
    <section>
        <h2 class="text-2xl font-bold mb-6 text-center" style="color:#122C4F;">ðŸ”¥ Top 3 Products ðŸ”¥</h2>

        <!-- Product list container -->
        <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
            {% for product in hot_products %}
            <div class="bg-white shadow rounded-lg p-4 text-center">
                <div class="w-full aspect-square mb-4">
                    {% if product.thumbnail %}
                    <img src="{{ product.thumbnail }}" 
                         alt="{{ product.name }}" 
                         class="max-w-[300px] w-full h-auto mx-auto rounded-md object-contain">
                    {% endif %}
                </div>

                <h3 class="text-xl font-bold text-gray-900 mb-2">{{ product.name }}</h3>
                <p class="text-lg font-semibold text-gray-800 mb-2">Rp {{ product.price }}</p>

                <a href="{% url 'main:product_detail' product.id %}" 
                   class="px-4 py-2 rounded text-white transition"
                   style="background-color: #5B88B2;"
                   onmouseover="this.style.backgroundColor='#4972a0'" 
                   onmouseout="this.style.backgroundColor='#5B88B2'">
                   Product Details
                </a>
            </div>
            {% endfor %}
        </div>

        {% if not hot_products %}
        <p class="text-gray-500 text-center">Belum ada produk favorit</p>
        {% endif %}
    </section>

    <div class="mt-12 text-center text-sm text-gray-500">
        <p>Sesi terakhir login: {{ last_login }}</p>
    </div>
</div>

<!-- ðŸ” AJAX SCRIPT -->
<script>
document.getElementById('refresh-btn').addEventListener('click', function() {
    fetch("{% url 'main:get_products' %}")  // pastikan URL ini sudah ada di urls.py
        .then(response => response.json())
        .then(products => {
            const list = document.getElementById('product-list');
            list.innerHTML = ''; // kosongkan produk lama

            if (products.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center col-span-3">Belum ada produk</p>';
                return;
            }

            products.slice(0, 3).forEach(p => {
                list.innerHTML += `
                    <div class="bg-white shadow rounded-lg p-4 text-center">
                        <div class="w-full aspect-square mb-4">
                            <img src="${p.thumbnail}" 
                                 alt="${p.name}" 
                                 class="max-w-[300px] w-full h-auto mx-auto rounded-md object-contain">
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${p.name}</h3>
                        <p class="text-lg font-semibold text-gray-800 mb-2">Rp ${p.price}</p>
                        <a href="/details/${p.id}" 
                           class="px-4 py-2 rounded text-white transition"
                           style="background-color: #5B88B2;"
                           onmouseover="this.style.backgroundColor='#4972a0'" 
                           onmouseout="this.style.backgroundColor='#5B88B2'">
                           Product Details
                        </a>
                    </div>
                `;
            });
        })
        .catch(err => {
            console.error("Gagal mengambil data produk:", err);
        });
});
</script>

{% endblock content %}
